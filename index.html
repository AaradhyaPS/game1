<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Endless Level Devil</title>
<style>
html,body{margin:0;padding:0;height:100%;background:#071220;font-family:Arial,sans-serif}
#canvasWrap{display:flex;align-items:center;justify-content:center;height:100vh}
canvas{background:linear-gradient(#87CEEB,#cfe9ff);max-width:100%;height:auto;border-radius:10px;box-shadow:0 14px 40px rgba(0,0,0,0.6);}
#uiTop{position:fixed;top:12px;left:12px;color:#fff;z-index:10}
#uiTop .box{background:rgba(0,0,0,0.45);padding:8px 12px;border-radius:8px;margin-bottom:8px}
#controls{position:fixed;right:12px;bottom:12px;display:flex;flex-direction:column;gap:8px;z-index:10}
.btn{background:#1f2937;border:0;padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;box-shadow:0 6px 12px rgba(0,0,0,0.25);touch-action:none}
#menu{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:20;color:#fff}
.panel{background:linear-gradient(180deg,rgba(0,0,0,0.75),rgba(0,0,0,0.45));padding:18px;border-radius:14px;text-align:center;width:360px}
.small{font-size:12px;color:#ddd}
@media(max-width:600px){.panel{width:92vw} canvas{width:95vw}}
</style>
</head>
<body>

<div id="canvasWrap"><canvas id="game" width="1000" height="560"></canvas></div>

<div id="uiTop">
  <div class="box">Level: <span id="level">1</span> &nbsp; Score: <span id="score">0</span> &nbsp; Coins: <span id="coins">0</span></div>
  <div class="box">Best: <span id="best">0</span></div>
</div>

<div id="controls">
  <button id="jump" class="btn">▲</button>
  <button id="pause" class="btn">Pause</button>
  <button id="mute" class="btn">Mute</button>
</div>

<div id="menu">
  <div class="panel" id="startPanel">
    <h2>Endless Level Devil</h2>
    <p class="small" style="opacity:0.9">Smooth endless runner with Level Devil character.</p>
    <button id="startBtn" class="btn">Start Game</button>
    <button id="howBtn" class="btn" style="background:#4caf50;margin-top:8px">How to Play</button>
    <div class="small" style="margin-top:8px;">Controls: W/Space/↑ to jump. Mobile: use jump button.</div>
  </div>

  <div class="panel" id="pausePanel" style="display:none">
    <h3>Paused</h3>
    <button id="resume" class="btn">Resume</button>
    <button id="restart" class="btn" style="background:#e74c3c;margin-top:10px">Restart</button>
  </div>

  <div class="panel" id="howPanel" style="display:none">
    <h3>How to Play</h3>
    <p class="small">Jump to avoid spikes and gaps, collect coins, and reach the next level. Endless rounds, respawn at last checkpoint if you die.</p>
    <button id="backBtn" class="btn">Back</button>
  </div>
</div>

<script>
/* --------- Canvas --------- */
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
canvas.width=1000; canvas.height=560;

/* --------- UI Elements --------- */
const levelEl=document.getElementById('level');
const scoreEl=document.getElementById('score');
const coinsEl=document.getElementById('coins');
const bestEl=document.getElementById('best');
let highScore=parseInt(localStorage.getItem('runner_high')||'0'); bestEl.innerText=highScore;

/* --------- Controls --------- */
let keys={};
window.addEventListener('keydown',e=>{ keys[e.key]=true; if(e.key==='p') togglePause(); if(e.key==='m') SOUND_ON=!SOUND_ON; updateMute(); });
window.addEventListener('keyup',e=>{ keys[e.key]=false; });
document.getElementById('jump').addEventListener('pointerdown',()=>{ keys[' '] = true; setTimeout(()=> keys[' ']=false,120); });
document.getElementById('pause').addEventListener('click',togglePause);
document.getElementById('resume').addEventListener('click',resumeGame);
document.getElementById('restart').addEventListener('click',()=>resetAll(true));
document.getElementById('startBtn').addEventListener('click',()=>{startPanel.style.display='none'; startGame();});
document.getElementById('howBtn').addEventListener('click',()=>{startPanel.style.display='none'; howPanel.style.display='block';});
document.getElementById('backBtn').addEventListener('click',()=>{howPanel.style.display='none'; startPanel.style.display='block';});

/* --------- Game variables --------- */
const CAMERA_LEFT=260;
let camX=0,levelNumber=1,score=0,coinsCollected=0,lastTime=0,paused=false,SOUND_ON=true;

/* --------- Player --------- */
class Player{
  constructor(){ this.reset(); this.checkpointX=120; this.checkpointY=360; }
  reset(){ this.x=this.checkpointX; this.y=this.checkpointY; this.w=30; this.h=46; this.vx=6; this.vy=0; this.onGround=false; }
  update(dt){
    this.vy+=0.9*(dt/16);
    if((keys[' ']||keys['w']||keys['ArrowUp'])&&this.onGround){ this.vy=-15; this.onGround=false;}
    this.x+=this.vx*(dt/16);
    this.y+=this.vy*(dt/16);
    this.onGround=false;
    for(let p of level.platforms){if(this.x+this.w>p.x&&this.x<p.x+p.w){if(this.y+this.h>p.y&&this.y+this.h<p.y+20&&this.vy>=0){this.y=p.y-this.h; this.vy=0; this.onGround=true;}}}
    for(let s of level.spikes){if(this.x+this.w>s.x&&this.x<s.x+s.w&&this.y+this.h>s.y&&this.y<s.y+s.h) this.die();}
    if(this.y>canvas.height+200) this.die();
    for(let cp of level.checkpoints){if(!cp.activated&&this.x+this.w>cp.x){cp.activated=true; this.checkpointX=cp.x-20; this.checkpointY=cp.y-this.h;}}
    for(let c of level.coins){if(!c.collected&&this.x+this.w>c.x&&this.x<c.x+c.size&&this.y+this.h>c.y&&this.y<c.y+c.size){c.collected=true; coinsCollected++; score+=100; coinsEl.innerText=coinsCollected;}}
    if(this.x>level.finishX-50){advanceLevel();}
  }
  die(){score=Math.max(0,score-80);coinsCollected=0;coinsEl.innerText=coinsCollected; this.reset(); camX=0;}
  draw(){ const px=this.x-camX,py=this.y; ctx.fillStyle='#000'; ctx.fillRect(px,py,this.w,this.h);}
}

const player=new Player();

/* --------- Level objects --------- */
class Platform{constructor(x,y,w){this.x=x;this.y=y;this.w=w;this.h=20;} draw(){ctx.fillStyle='#374151';ctx.fillRect(this.x-camX,this.y,this.w,this.h);}}
class Spike{constructor(x,y){this.x=x;this.y=y;this.w=28;this.h=28;} draw(){ctx.fillStyle='#b91c1c';ctx.beginPath();ctx.moveTo(this.x-camX,this.y+this.h);ctx.lineTo(this.x-camX+this.w/2,this.y);ctx.lineTo(this.x-camX+this.w,this.y+this.h);ctx.fill();}}
class Coin{constructor(x,y){this.x=x;this.y=y;this.size=16;this.collected=false;} draw(){if(this.collected)return;ctx.fillStyle='#ffd700';ctx.beginPath();ctx.arc(this.x-camX+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2);ctx.fill();}}
class Checkpoint{constructor(x,y){this.x=x;this.y=y;this.activated=false;} draw(){ctx.fillStyle=this.activated?'#10b981':'#ffd54f';ctx.fillRect(this.x-camX-6,this.y-50,12,40);ctx.fillStyle=this.activated?'#064e3b':'#6d4c41';ctx.fillRect(this.x-camX-10,this.y-12,32,8);}}
let level={platforms:[],spikes:[],coins:[],checkpoints:[],finishX:0};

/* --------- Level generation --------- */
function buildLevel(n){
  level.platforms=[]; level.spikes=[]; level.coins=[]; level.checkpoints=[];
  const mapWidth=700*5;
  level.platforms.push(new Platform(0,420,mapWidth+400));
  let x=220;
  while(x<mapWidth-240){
    const gap=Math.floor(Math.random()*120)+100;
    const pW=Math.floor(Math.random()*260)+120;
    const pY=Math.floor(Math.random()*140)+260;
    const px=x+gap;
    level.platforms.push(new Platform(px,pY,pW));
    if(Math.random()<0.3){ level.spikes.push(new Spike(px+Math.floor(Math.random()*(pW-20)),pY-28));}
    if(Math.random()<0.5){ const cx=px+Math.floor(Math.random()*(pW-20)); level.coins.push(new Coin(cx,pY-40));}
    if(Math.random()<0.2){ level.checkpoints.push(new Checkpoint(px+pW/2,pY));}
    x+=gap+pW+Math.floor(Math.random()*80)+80;
  }
  if(level.checkpoints.length===0){level.checkpoints.push(new Checkpoint(mapWidth/2,360));}
  level.finishX=mapWidth-160;
}

/* --------- Game Functions --------- */
function startGame(){ buildLevel(levelNumber); player.reset(); camX=0; score=0; coinsCollected=0; lastTime=performance.now(); requestAnimationFrame(loop);}
function togglePause(){paused=!paused; pausePanel.style.display=paused?'block':'none'; if(!paused) lastTime=performance.now(); if(!paused) requestAnimationFrame(loop);}
function resumeGame(){paused=false; pausePanel.style.display='none'; lastTime=performance.now(); requestAnimationFrame(loop);}
function resetAll(full=false){levelNumber=1; score=0; coinsCollected=0; player.checkpointX=120; player.checkpointY=360; buildLevel(levelNumber); player.reset(); camX=0; levelEl.innerText=levelNumber; scoreEl.innerText=score; coinsEl.innerText=coinsCollected;}
function advanceLevel(){levelNumber++; levelEl.innerText=levelNumber; score+=Math.floor(level.finishX/10); scoreEl.innerText=score; if(score>highScore){highScore=score; localStorage.setItem('runner_high',highScore); bestEl.innerText=highScore;} buildLevel(levelNumber); player.reset(); camX=0; coinsCollected=0; coinsEl.innerText=coinsCollected;}

/* --------- Main Loop --------- */
function loop(now){
  if(paused) return;
  const dt=Math.min(40,now-lastTime); lastTime=now;
  player.update(dt);
  camX=player.x-CAMERA_LEFT; if(camX<0) camX=0;
  drawScene();
  requestAnimationFrame(loop);
}

/* --------- Draw Scene --------- */
function drawScene(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Sky
  const g=ctx.createLinearGradient(0,0,0,canvas.height); g.addColorStop(0,'#87CEEB'); g.addColorStop(1,'#cfe9ff'); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
  // Ground
  ctx.fillStyle='#2d3748'; ctx.fillRect(-camX,460,canvas.width+camX,canvas.height-460);
  // Platforms
  level.platforms.forEach(p=>p.draw());
  // Spikes
  level.spikes.forEach(s=>s.draw());
  // Coins
  level.coins.forEach(c=>c.draw());
  // Checkpoints
  level.checkpoints.forEach(cp=>cp.draw());
  // Finish Flag
  ctx.fillStyle='#ffd54f'; ctx.fillRect(level.finishX-camX,300,12,140);
  ctx.fillStyle='#6d4c41'; ctx.fillRect(level.finishX-camX-8,420,36,20);
  // Player
  player.draw();
}

function updateMute(){document.getElementById('mute').innerText=SOUND_ON?'Mute':'Unmute';}
updateMute();

</script>
</body>
</html>
